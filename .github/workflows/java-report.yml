name: Java Report for BankApplication

on:
  push:
  pull_request:

jobs:
  java-report:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Scan Java files and generate report
        shell: bash
        run: |
          set -euo pipefail
          REPORT="java-file-report.txt"
          mapfile -t JAVA_FILES < <(find . -type f -name "*.java")
          
          if [ "${#JAVA_FILES[@]}" -eq 0 ]; then
            echo "ERROR: No .java files found."
            exit 1
          fi

          if find . -type f -name "*.class" | grep -q .; then
            echo "ERROR: Compiled *.class files are committed (bad practice)."
            exit 1
          fi

          TOTAL_LINES=0

          echo "Java File Report" > "$REPORT"
          echo "================" >> "$REPORT"
          echo "" >> "$REPORT"
          echo "Per-file breakdown:" >> "$REPORT"

          for file in "${JAVA_FILES[@]}"; do
            LINE_COUNT=$(wc -l < "$file")
            TOTAL_LINES=$((TOTAL_LINES + LINE_COUNT))
            echo "${file#./} â€“ ${LINE_COUNT}" >> "$REPORT"
          done

          echo "" >> "$REPORT"
          echo "Summary:" >> "$REPORT"
          echo "Number of .java files: ${#JAVA_FILES[@]}" >> "$REPORT"
          echo "Total lines of code: $TOTAL_LINES" >> "$REPORT"

          echo "java-file-report.txt generated"

      - name: Upload java-file-report.txt
        uses: actions/upload-artifact@v4
        with:
          name: java-file-report
          path: java-file-report.txt
